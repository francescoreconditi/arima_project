<div class="dashboard-container" style="background: var(--background-primary, #fafafa) !important; min-height: 100vh !important; padding: 20px !important; font-family: 'Roboto', Arial, sans-serif !important; color: var(--text-primary, #212121) !important;">
  
  <!-- Sistema operativo status -->
  <div style="background: var(--primary-color, #1976d2) !important; color: white !important; padding: 15px !important; margin-bottom: 20px !important; border-radius: 8px !important; font-weight: 500 !important; text-align: center !important;">
    [MEDICAL] Sistema Gestione Scorte - Dashboard Attiva
  </div>
  <!-- Header con controlli -->
  <div class="dashboard-header" style="background: rgba(255,255,255,0.9) !important; padding: 15px !important; border-radius: 10px !important; margin-bottom: 20px !important; box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important; display: flex !important; justify-content: space-between !important; align-items: center !important;">
    <div class="header-left">
      <h1 class="dashboard-title" style="font-size: 1.5rem !important; font-weight: bold !important; color: #1976d2 !important; margin: 0 !important;">
        <span class="logo">[MEDICAL]</span>
        Moretti S.p.A. - Sistema Gestione Scorte Intelligente
      </h1>
    </div>
    
    <div class="header-controls" style="display: flex !important; gap: 15px !important; align-items: center !important;">
      <div class="control-group">
        <label for="category-select">Categoria:</label>
        <select 
          id="category-select" 
          class="form-control"
          style="padding: 8px 12px !important; border: 1px solid #ddd !important; border-radius: 5px !important; background: white !important; color: #333 !important; margin-left: 8px !important;"
          [(ngModel)]="selectedCategory"
          (change)="onCategorySelect($any($event.target).value || '')">
          <option value="">Tutte</option>
          <option value="Carrozzine">Carrozzine</option>
          <option value="Materassi Antidecubito">Materassi Antidecubito</option>
          <option value="Elettromedicali">Elettromedicali</option>
        </select>
      </div>
      
      <div class="control-group">
        <label for="product-select">Prodotto:</label>
        <select 
          id="product-select" 
          class="form-control"
          style="padding: 8px 12px !important; border: 1px solid #ddd !important; border-radius: 5px !important; background: white !important; color: #333 !important; margin-left: 8px !important;"
          [(ngModel)]="selectedProduct"
          (change)="onProductSelect($any($event.target).value || '')">
          <option value="">Tutti</option>
          <option value="CRZ001">Carrozzina Standard</option>
          <option value="MAT001">Materasso Antidecubito</option>
          <option value="ELT001">Saturimetro Digitale</option>
        </select>
      </div>
      
      <button 
        class="btn btn-primary"
        style="background: #1976d2 !important; color: white !important; border: none !important; padding: 10px 20px !important; border-radius: 5px !important; cursor: pointer !important; font-weight: bold !important;"
        (click)="dataService.refreshData().subscribe()"
        title="Aggiorna dati">
        Aggiorna
      </button>
    </div>
  </div>

  <!-- Dashboard Grid with CDK Drag & Drop -->
  <div class="dashboard-content" style="flex: 1 !important; padding: 0 !important; margin: 0 !important;">
    <div cdkDropListGroup class="dashboard-grid" style="display: grid !important; grid-template-columns: repeat(12, 1fr) !important; gap: 10px !important; padding: 10px !important; min-height: 600px !important;">
      
      <div 
        cdkDrag
        *ngFor="let item of dashboard; trackBy: trackByFn"
        class="gridster-item-wrapper dashboard-widget"
        [style.grid-column]="'span ' + item.cols"
        [style.grid-row]="'span ' + item.rows"
        style="background: white !important; border-radius: 12px !important; box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important; min-height: 200px !important; cursor: move !important;"
        cdkDragBoundary=".dashboard-grid">
        
        <div class="gridster-item-content">
          <!-- Controlli widget -->
          <div class="widget-header drag-handle" style="display: flex !important; justify-content: space-between !important; align-items: center !important; padding: 8px 12px !important; background: rgba(25, 118, 210, 0.1) !important; border-radius: 8px 8px 0 0 !important; margin: -10px -10px 10px -10px !important; border-bottom: 1px solid #e0e0e0 !important; cursor: move !important; user-select: none !important;">
            <!-- Drag handle -->
            <div class="drag-handler" 
                 style="cursor: move !important; 
                        color: #1976d2 !important; 
                        font-size: 1.4rem !important; 
                        padding: 8px !important; 
                        user-select: none !important;
                        background: rgba(25, 118, 210, 0.1) !important;
                        border-radius: 4px !important;
                        border: 1px solid rgba(25, 118, 210, 0.2) !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        min-width: 24px !important;
                        min-height: 24px !important;
                        z-index: 1000 !important;" 
                 title="Trascina per spostare"
                 (mousedown)="onDragStart($event)"
                 (mouseup)="onDragEnd($event)">
              <span style="font-weight: bold !important; line-height: 1 !important; pointer-events: none !important;">⋮⋮</span>
            </div>
            
            <!-- Widget title -->
            <div style="flex: 1 !important; text-align: center !important; font-size: 0.9rem !important; color: #1976d2 !important; font-weight: 600 !important;">
              {{ getWidgetTitle(item.component) }}
            </div>
            
            <!-- Remove button -->
            <button 
              class="widget-remove-btn"
              (click)="removeItem($event, item)"
              style="background: none !important; border: none !important; color: #666 !important; font-size: 1.2rem !important; cursor: pointer !important; padding: 4px !important; border-radius: 4px !important; transition: all 0.2s ease !important; pointer-events: auto !important; z-index: 1001 !important;"
              title="Rimuovi widget"
              (mousedown)="$event.stopPropagation()"
              (mouseup)="$event.stopPropagation()">
              ×
            </button>
          </div>

          <!-- KPI Cards Widget -->
          <app-kpi-cards 
            *ngIf="item.component === 'kpi-cards'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-kpi-cards>

          <!-- Forecast Chart Widget -->
          <app-forecast-chart 
            *ngIf="item.component === 'forecast-chart'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-forecast-chart>

          <!-- Inventory Table Widget -->
          <app-inventory-table 
            *ngIf="item.component === 'inventory-table'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-inventory-table>

          <!-- Supplier Optimization Widget -->
          <app-supplier-optimization 
            *ngIf="item.component === 'supplier-optimization'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-supplier-optimization>

          <!-- Alerts Panel Widget -->
          <app-alerts-panel 
            *ngIf="item.component === 'alerts-panel'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-alerts-panel>

          <!-- What-If Analysis Widget -->
          <app-what-if-analysis 
            *ngIf="item.component === 'what-if-analysis'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-what-if-analysis>

        </div>
      </div>

    </div>
  </div>

  <!-- Footer con informazioni -->
  <div class="dashboard-footer">
    <div class="footer-info">
      <span>Ultimo aggiornamento: {{ now | date:'short' }}</span>
      <span class="separator">•</span>
      <span>Prodotti monitorati: 3</span>
      <span class="separator">•</span>
      <span class="status-indicator" [class.active]="true">Sistema attivo</span>
    </div>
  </div>
</div>
