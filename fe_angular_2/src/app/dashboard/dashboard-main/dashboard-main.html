<div class="dashboard-container" style="background: var(--background-primary, #fafafa) !important; min-height: 100vh !important; padding: 20px !important; font-family: 'Roboto', Arial, sans-serif !important; color: var(--text-primary, #212121) !important;">
  
  <!-- Sistema operativo status -->
  <div style="background: var(--primary-color, #1976d2) !important; color: white !important; padding: 15px !important; margin-bottom: 20px !important; border-radius: 8px !important; font-weight: 500 !important; text-align: center !important;">
    [MEDICAL] Sistema Gestione Scorte - Dashboard Attiva
  </div>
  <!-- Header con controlli -->
  <div class="dashboard-header" style="background: rgba(255,255,255,0.9) !important; padding: 15px !important; border-radius: 10px !important; margin-bottom: 20px !important; box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important; display: flex !important; justify-content: space-between !important; align-items: center !important;">
    <div class="header-left">
      <h1 class="dashboard-title" style="font-size: 1.5rem !important; font-weight: bold !important; color: #1976d2 !important; margin: 0 !important;">
        <span class="logo">[MEDICAL]</span>
        Moretti S.p.A. - Sistema Gestione Scorte Intelligente
      </h1>
    </div>
    
    <div class="header-controls" style="display: flex !important; gap: 15px !important; align-items: center !important;">
      <div class="control-group">
        <label for="category-select">Categoria:</label>
        <select 
          id="category-select" 
          class="form-control"
          style="padding: 8px 12px !important; border: 1px solid #ddd !important; border-radius: 5px !important; background: white !important; color: #333 !important; margin-left: 8px !important;"
          [(ngModel)]="selectedCategory"
          (change)="onCategorySelect($any($event.target).value || '')">
          <option value="">Tutte</option>
          <option value="Carrozzine">Carrozzine</option>
          <option value="Materassi Antidecubito">Materassi Antidecubito</option>
          <option value="Elettromedicali">Elettromedicali</option>
        </select>
      </div>
      
      <div class="control-group">
        <label for="product-select">Prodotto:</label>
        <select 
          id="product-select" 
          class="form-control"
          style="padding: 8px 12px !important; border: 1px solid #ddd !important; border-radius: 5px !important; background: white !important; color: #333 !important; margin-left: 8px !important;"
          [(ngModel)]="selectedProduct"
          (change)="onProductSelect($any($event.target).value || '')">
          <option value="">Tutti</option>
          <option value="CRZ001">Carrozzina Standard</option>
          <option value="MAT001">Materasso Antidecubito</option>
          <option value="ELT001">Saturimetro Digitale</option>
        </select>
      </div>
      
      <button 
        class="btn btn-primary"
        style="background: #1976d2 !important; color: white !important; border: none !important; padding: 10px 20px !important; border-radius: 5px !important; cursor: pointer !important; font-weight: bold !important;"
        (click)="dataService.refreshData().subscribe()"
        title="Aggiorna dati">
        Aggiorna
      </button>
    </div>
  </div>

  <!-- Dashboard Grid -->
  <div class="dashboard-content" style="flex: 1 !important; padding: 0 !important; margin: 0 !important;">
    <gridster [options]="options" style="height: 100% !important; width: 100% !important;">
      
      <gridster-item 
        [item]="item" 
        *ngFor="let item of dashboard; trackBy: trackByFn"
        class="gridster-item-wrapper">
        
        <div class="gridster-item-content">
          <!-- Controlli widget -->
          <div class="widget-header">
            <button 
              class="widget-remove-btn"
              (click)="removeItem($event, item)"
              title="Rimuovi widget">
              ×
            </button>
          </div>

          <!-- KPI Cards Widget -->
          <app-kpi-cards 
            *ngIf="item.component === 'kpi-cards'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-kpi-cards>

          <!-- Forecast Chart Widget -->
          <app-forecast-chart 
            *ngIf="item.component === 'forecast-chart'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-forecast-chart>

          <!-- Inventory Table Widget -->
          <app-inventory-table 
            *ngIf="item.component === 'inventory-table'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-inventory-table>

          <!-- Supplier Optimization Widget -->
          <app-supplier-optimization 
            *ngIf="item.component === 'supplier-optimization'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-supplier-optimization>

          <!-- Alerts Panel Widget -->
          <app-alerts-panel 
            *ngIf="item.component === 'alerts-panel'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-alerts-panel>

          <!-- What-If Analysis Widget -->
          <app-what-if-analysis 
            *ngIf="item.component === 'what-if-analysis'"
            [selectedProduct]="selectedProduct"
            [selectedCategory]="selectedCategory">
          </app-what-if-analysis>

        </div>
      </gridster-item>

    </gridster>
  </div>

  <!-- Footer con informazioni -->
  <div class="dashboard-footer">
    <div class="footer-info">
      <span>Ultimo aggiornamento: {{ now | date:'short' }}</span>
      <span class="separator">•</span>
      <span>Prodotti monitorati: 3</span>
      <span class="separator">•</span>
      <span class="status-indicator" [class.active]="true">Sistema attivo</span>
    </div>
  </div>
</div>
